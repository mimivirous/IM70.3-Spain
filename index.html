<!-- Chosen Palette: Coastal Horizon (Main: White/Light Gray, Accent: Indigo-600, Secondary Accent: Amber-600) -->
<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ironman 西班牙 12 日探索儀表板</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.3/dist/chart.umd.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f7f7f7; }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 450px;
            margin-left: auto;
            margin-right: auto;
            height: 350px;
            max-height: 400px;
        }
        @media (min-width: 768px) {
            .chart-container { max-width: 600px; height: 400px; }
        }
        .timeline-dot {
            position: absolute;
            left: -15px;
            top: 5px;
            width: 15px;
            height: 15px;
            background-color: #4f46e5;
            border-radius: 50%;
            border: 3px solid #f7f7f7;
        }
        .timeline-item { position: relative; padding-left: 20px; border-left: 2px solid #e0e0e0; margin-bottom: 10px; }
    </style>
</head>
<body class="antialiased text-gray-800">

    <!-- Header Navigation -->
    <header class="sticky top-0 z-50 bg-white shadow-md">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 flex justify-between items-center">
            <h1 class="text-2xl font-bold text-indigo-600">🇪🇸 Ironman 西班牙 (12日行程)</h1>
            <nav class="space-x-4">
                <a href="#dashboard" class="text-gray-600 hover:text-indigo-600 transition duration-150 font-medium hidden sm:inline">儀表板</a>
                <a href="#itinerary" class="text-gray-600 hover:text-indigo-600 transition duration-150 font-medium">行程時間軸</a>
                <a href="#logistics" class="text-gray-600 hover:text-indigo-600 transition duration-150 font-medium hidden sm:inline">物流/費用</a>
            </nav>
        </div>
    </header>

    <!-- Main Content Area -->
    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-10">

        <!-- Dashboard Section -->
        <section id="dashboard" class="mb-12">
            <h2 class="text-3xl font-extrabold text-indigo-700 mb-6 border-b-2 border-indigo-200 pb-2">🎯 旅程概覽與準備行動</h2>
            <p class="mb-8 text-gray-600">
                本儀表板匯集了 **12 日**西班牙之旅的關鍵數據。11/4 抵達馬德里後直接前往托雷多，開啟精彩旅程！
            </p>

            <div class="grid grid-cols-2 md:grid-cols-4 gap-6 mb-10">
                <div class="p-5 bg-white rounded-xl shadow-lg border-b-4 border-indigo-500 transform hover:scale-[1.02] transition duration-200">
                    <p class="text-sm font-medium text-gray-500">總日數</p>
                    <p id="stat-days" class="text-3xl font-bold text-indigo-800">12</p>
                </div>
                <div class="p-5 bg-white rounded-xl shadow-lg border-b-4 border-indigo-500 transform hover:scale-[1.02] transition duration-200">
                    <p class="text-sm font-medium text-gray-500">參與人數</p>
                    <p id="stat-people" class="text-3xl font-bold text-indigo-800">8 位</p>
                </div>
                <div class="p-5 bg-white rounded-xl shadow-lg border-b-4 border-amber-500 transform hover:scale-[1.02] transition duration-200">
                    <p class="text-sm font-medium text-gray-500">交通工具</p>
                    <p id="stat-transport" class="text-3xl font-bold text-amber-800">2 輛租車</p>
                </div>
                <div class="p-5 bg-white rounded-xl shadow-lg border-b-4 border-amber-500 transform hover:scale-[1.02] transition duration-200">
                    <p class="text-sm font-medium text-gray-500">比賽地點</p>
                    <p id="stat-race" class="text-xl font-bold text-amber-800 mt-1">Marbella</p>
                </div>
            </div>

            <!-- Interactive Checklist -->
            <div class="p-6 bg-white rounded-xl shadow-2xl">
                <h3 class="text-xl font-bold text-indigo-600 mb-4">✅ 行前準備清單</h3>
                <p class="text-sm text-gray-500 mb-4">點擊項目即可追蹤完成狀態。</p>
                <div id="checklist-container" class="space-y-3">
                    <!-- Checklist items will be injected here by JS -->
                </div>
            </div>
        </section>

        <!-- Itinerary Section (Timeline) -->
        <section id="itinerary" class="mb-12 pt-10">
            <h2 class="text-3xl font-extrabold text-indigo-700 mb-6 border-b-2 border-indigo-200 pb-2">📅 12 日行程時間軸 (點擊查看細節)</h2>
            <p class="mb-8 text-gray-600">
                從托雷多古城到馬貝拉海灘，從格拉納達的阿爾罕布拉宮到塞維亞的佛朗明哥，精彩 12 天等你探索！
            </p>

            <div id="timeline-container" class="relative">
                <!-- Timeline items will be injected here by JS -->
            </div>
        </section>

        <!-- Logistics & Cost Section -->
        <section id="logistics" class="pt-10">
            <h2 class="text-3xl font-extrabold text-indigo-700 mb-6 border-b-2 border-indigo-200 pb-2">💰 物流與費用分析</h2>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                <!-- Logistics Summary Card -->
                <div class="p-6 bg-white rounded-xl shadow-2xl flex flex-col justify-center">
                    <h3 class="text-xl font-bold text-indigo-600 mb-3">🚗 核心物流決策</h3>
                    <div class="space-y-4 text-gray-700">
                        <div class="p-3 bg-indigo-50 rounded-lg">
                            <p class="font-semibold text-indigo-800">交通方案 (已確認)</p>
                            <p>租賃 **2 輛車**，全程自駕。每台租金 $8,600（11/4-11/14全包），舒適容納 8 人和所有行李，行程彈性最高。</p>
                        </div>
                        <div class="p-3 bg-amber-50 rounded-lg">
                            <p class="font-semibold text-amber-800">自行車處理 (已確認)</p>
                            <p>Ironman 選手（雅菁、皓中哥、光武）的自行車將在馬貝拉 **當地租賃**，免去長途運輸的麻煩。</p>
                        </div>
                        <div class="p-3 bg-indigo-50 rounded-lg">
                            <p class="font-semibold text-indigo-800">住宿總結</p>
                            <p>住宿安排以公寓和精品酒店為主，總費用約 $169,699。馬貝拉期間光武爸媽另外住宿，馬德里分兩處住宿。</p>
                        </div>
                    </div>
                </div>

                <!-- Cost Chart Container -->
                <div>
                    <h3 class="text-xl font-bold text-indigo-600 mb-4 text-center">總預估費用 (約 NT$<span id="total-cost">621,599</span>) 分佈</h3>
                    <p class="text-sm text-center text-gray-500 mb-2">單位：新台幣 (TWD)</p>
                    <div class="chart-container shadow-2xl rounded-xl bg-white p-4">
                        <canvas id="costBreakdownChart"></canvas>
                    </div>
                    <div class="mt-4 p-3 bg-amber-50 rounded-lg text-sm text-gray-600">
                        <p class="font-semibold text-amber-800 mb-2">💡 交通費用明細（預估）：</p>
                        <ul class="space-y-1 text-xs">
                            <li>• 租車含保險：$17,200（2台 × $8,600）</li>
                            <li>• 油費：$15,700（約3,020km，預估）</li>
                            <li>• 停車費：$3,500（市區停車，預估）</li>
                            <li>• 過路費：$1,500（高速公路，預估）</li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- Individual Cost Breakdown Table -->
            <div class="mt-12">
                <h3 class="text-2xl font-bold text-indigo-700 mb-6 text-center">👥 每人費用明細</h3>
                
                <div class="bg-white rounded-xl shadow-2xl overflow-hidden">
                    <div class="overflow-x-auto">
                        <table class="w-full">
                            <thead class="bg-indigo-600 text-white">
                                <tr>
                                    <th class="px-6 py-4 text-left font-semibold">成員</th>
                                    <th class="px-6 py-4 text-right font-semibold">機票</th>
                                    <th class="px-6 py-4 text-right font-semibold">住宿</th>
                                    <th class="px-6 py-4 text-right font-semibold">交通</th>
                                    <th class="px-6 py-4 text-right font-semibold">餐費活動</th>
                                    <th class="px-6 py-4 text-right font-semibold bg-indigo-700">總計</th>
                                </tr>
                            </thead>
                            <tbody class="divide-y divide-gray-200">
                                <!-- 光武 -->
                                <tr class="hover:bg-indigo-50 transition">
                                    <td class="px-6 py-4 font-medium text-gray-900">光武</td>
                                    <td class="px-6 py-4 text-right text-gray-700">$38,000</td>
                                    <td class="px-6 py-4 text-right text-gray-700">$19,761</td>
                                    <td class="px-6 py-4 text-right text-gray-700">$4,738</td>
                                    <td class="px-6 py-4 text-right text-gray-700">$13,750</td>
                                    <td class="px-6 py-4 text-right font-bold text-indigo-700 bg-indigo-50">$76,249</td>
                                </tr>
                                <!-- 聿凡 -->
                                <tr class="hover:bg-indigo-50 transition">
                                    <td class="px-6 py-4 font-medium text-gray-900">聿凡</td>
                                    <td class="px-6 py-4 text-right text-gray-700">$38,000</td>
                                    <td class="px-6 py-4 text-right text-gray-700">$19,761</td>
                                    <td class="px-6 py-4 text-right text-gray-700">$4,738</td>
                                    <td class="px-6 py-4 text-right text-gray-700">$13,750</td>
                                    <td class="px-6 py-4 text-right font-bold text-indigo-700 bg-indigo-50">$76,249</td>
                                </tr>
                                <!-- 雅菁 -->
                                <tr class="hover:bg-indigo-50 transition">
                                    <td class="px-6 py-4 font-medium text-gray-900">雅菁</td>
                                    <td class="px-6 py-4 text-right text-gray-700">$38,000</td>
                                    <td class="px-6 py-4 text-right text-gray-700">$19,761</td>
                                    <td class="px-6 py-4 text-right text-gray-700">$4,738</td>
                                    <td class="px-6 py-4 text-right text-gray-700">$13,750</td>
                                    <td class="px-6 py-4 text-right font-bold text-indigo-700 bg-indigo-50">$76,249</td>
                                </tr>
                                <!-- 光武爸爸 -->
                                <tr class="hover:bg-amber-50 transition">
                                    <td class="px-6 py-4 font-medium text-gray-900">光武爸爸</td>
                                    <td class="px-6 py-4 text-right text-gray-700">$38,000</td>
                                    <td class="px-6 py-4 text-right text-gray-700">$26,043</td>
                                    <td class="px-6 py-4 text-right text-gray-700">$4,738</td>
                                    <td class="px-6 py-4 text-right text-gray-700">$13,750</td>
                                    <td class="px-6 py-4 text-right font-bold text-amber-700 bg-amber-50">$82,531</td>
                                </tr>
                                <!-- 光武媽媽 -->
                                <tr class="hover:bg-amber-50 transition">
                                    <td class="px-6 py-4 font-medium text-gray-900">光武媽媽</td>
                                    <td class="px-6 py-4 text-right text-gray-700">$38,000</td>
                                    <td class="px-6 py-4 text-right text-gray-700">$26,043</td>
                                    <td class="px-6 py-4 text-right text-gray-700">$4,738</td>
                                    <td class="px-6 py-4 text-right text-gray-700">$13,750</td>
                                    <td class="px-6 py-4 text-right font-bold text-amber-700 bg-amber-50">$82,531</td>
                                </tr>
                                <!-- 皓中哥 -->
                                <tr class="hover:bg-indigo-50 transition">
                                    <td class="px-6 py-4 font-medium text-gray-900">皓中哥</td>
                                    <td class="px-6 py-4 text-right text-gray-700">$38,000</td>
                                    <td class="px-6 py-4 text-right text-gray-700">$19,445</td>
                                    <td class="px-6 py-4 text-right text-gray-700">$4,738</td>
                                    <td class="px-6 py-4 text-right text-gray-700">$13,750</td>
                                    <td class="px-6 py-4 text-right font-bold text-indigo-700 bg-indigo-50">$75,933</td>
                                </tr>
                                <!-- 洪大哥 -->
                                <tr class="hover:bg-indigo-50 transition">
                                    <td class="px-6 py-4 font-medium text-gray-900">洪大哥</td>
                                    <td class="px-6 py-4 text-right text-gray-700">$38,000</td>
                                    <td class="px-6 py-4 text-right text-gray-700">$19,445</td>
                                    <td class="px-6 py-4 text-right text-gray-700">$4,738</td>
                                    <td class="px-6 py-4 text-right text-gray-700">$13,750</td>
                                    <td class="px-6 py-4 text-right font-bold text-indigo-700 bg-indigo-50">$75,933</td>
                                </tr>
                                <!-- 洪大嫂 -->
                                <tr class="hover:bg-indigo-50 transition">
                                    <td class="px-6 py-4 font-medium text-gray-900">洪大嫂</td>
                                    <td class="px-6 py-4 text-right text-gray-700">$38,000</td>
                                    <td class="px-6 py-4 text-right text-gray-700">$19,445</td>
                                    <td class="px-6 py-4 text-right text-gray-700">$4,738</td>
                                    <td class="px-6 py-4 text-right text-gray-700">$13,750</td>
                                    <td class="px-6 py-4 text-right font-bold text-indigo-700 bg-indigo-50">$75,933</td>
                                </tr>
                            </tbody>
                            <tfoot class="bg-gray-100">
                                <tr class="font-bold text-lg">
                                    <td class="px-6 py-4 text-gray-900">總計</td>
                                    <td class="px-6 py-4 text-right text-gray-900">$304,000</td>
                                    <td class="px-6 py-4 text-right text-gray-900">$169,699</td>
                                    <td class="px-6 py-4 text-right text-gray-900">$37,900</td>
                                    <td class="px-6 py-4 text-right text-gray-900">$110,000</td>
                                    <td class="px-6 py-4 text-right text-indigo-900 bg-indigo-100">$621,599</td>
                                </tr>
                            </tfoot>
                        </table>
                    </div>
                    
                    <!-- 住宿明細說明 -->
                    <div class="px-6 py-4 bg-gray-50 border-t border-gray-200">
                        <p class="text-sm text-gray-600 mb-2"><strong>💡 住宿費用說明：</strong></p>
                        <ul class="text-xs text-gray-600 space-y-1 ml-4">
                            <li>• <strong>光武、聿凡、雅菁</strong>：馬貝拉 6 人分擔 ($37,310÷6) + 馬德里住宿 A 5 人分擔 ($26,579÷5) = $19,761</li>
                            <li>• <strong>光武爸媽</strong>：馬貝拉另住 ($25,000÷2) + 馬德里住宿 A 5 人分擔 ($26,579÷5) + 其他住宿 8 人平均 = $26,043</li>
                            <li>• <strong>皓中哥、洪大哥、洪大嫂</strong>：馬貝拉 6 人分擔 ($37,310÷6) + 馬德里住宿 B 3 人分擔 ($15,000÷3) = $19,445</li>
                        </ul>
                    </div>
                </div>
            </div>

        </section>

    </main>

    <!-- Footer -->
    <footer class="mt-12 py-6 bg-gray-100 text-center text-sm text-gray-500">
        <p>&copy; 2025 Ironman 西班牙團隊規劃 | 資料更新日期：2025/10/29</p>
    </footer>

    <script>
        // Helper function to generate Google Maps link
        function getGoogleMapsLink(address) {
            const encodedAddress = encodeURIComponent(address);
            return `https://www.google.com/maps/search/?api=1&query=${encodedAddress}`;
        }

        const TRIP_DATA = {
            totalDays: 12,
            totalPeople: 8,
            raceLocation: "Marbella, Spain",
            estimatedCost: 621599,
            costBreakdown: [
                { label: "國際機票 (8人)", amount: 304000, percentage: 48.90, color: 'rgba(79, 70, 229, 0.8)' },
                { label: "住宿 (11晚)", amount: 169699, percentage: 27.30, color: 'rgba(234, 88, 12, 0.8)' },
                { label: "餐費與活動", amount: 110000, percentage: 17.70, color: 'rgba(251, 191, 36, 0.8)' },
                { label: "租車/油費/停車費 (預估)", amount: 37900, percentage: 6.10, color: 'rgba(129, 140, 248, 0.8)' }
            ]
        };

        let CHECKLIST_STATE = [
            { id: 1, text: "確認所有成員護照效期超過 6 個月", completed: false },
            { id: 2, text: "完成 2 輛租車預訂 (含保險)", completed: true },
            { id: 3, text: "確認所有駕駛國際駕照 (IDP) 效期", completed: false },
            { id: 4, text: "所有住宿預訂確認與付款", completed: true },
            { id: 5, text: "Ironman 賽事報到文件準備（雅菁、皓中哥、光武）", completed: false },
            { id: 6, text: "確認租賃自行車的尺寸與領取地點", completed: false },
            { id: 7, text: "購買旅行/意外/醫療保險", completed: false },
            { id: 8, text: "預訂阿爾罕布拉宮門票（需提前）", completed: false },
            { id: 9, text: "預訂佛朗明哥表演門票", completed: false },
            { id: 10, text: "預訂普拉多博物館、馬德里王宮門票（Klook）", completed: false },
        ];

        const ITINERARY_DATA = [
            { 
                day: 1, 
                date: "11/4 (二)", 
                location: "馬德里 → 托雷多", 
                title: "馬德里 → 托雷多", 
                transport: "12:40 抵達馬德里，14:30 領取租車，自駕至托雷多 (1hr 15min)。", 
                activities: ["12:40 抵達馬德里", "14:30 領取租車", "15:30-16:00 抵達托雷多並 check-in", "16:00-17:00 小休/市區逛逛", "18:00 Mirador del Valle 看日落", "20:15 晚餐", "22:00 休息調整時差"],
                food_recommendation: "必嚐當地甜點 Mazapán (杏仁糖)，以及經典的托雷多燉肉 Carcamusas。",
                accommodationName: "Hotel Domus Plaza Zocodover",
                accommodationAddress: "Armas 7, 托萊多, 45001, 西班牙"
            },
            { 
                day: 2, 
                date: "11/5 (三)", 
                location: "托雷多 → 格拉納達", 
                title: "托雷多 → 格拉納達", 
                transport: "SUV 自駕 (托雷多-格拉納達: 4hr，含20-30分鐘休息)。", 
                activities: ["07:30 晨跑/散步", "08:30 早餐", "10:00 托雷多主教堂", "12:00 午餐", "13:30 出發", "中途休息 20-30 分鐘", "18:00 抵達格拉納達", "20:00 晚餐"],
                food_recommendation: "在托萊多或格拉納達邊緣休息站享用午餐。",
                accommodationName: "阿里薩熱斯酒店",
                accommodationAddress: "P.º de la Sabica, 40, 18009 格拉納達, 安達盧西亞, 西班牙"
            },
            { 
                day: 3, 
                date: "11/6 (四)", 
                location: "格拉納達 → 馬貝拉", 
                title: "格拉納達 → 馬貝拉", 
                transport: "SUV 自駕 (格拉納達-馬貝拉: 2hr)。", 
                activities: ["8:00 阿爾罕布拉宮（購票碰運氣）", "08:30-09:45 納斯里德宮", "09:45-11:00 赫內拉利費宮與花園", "11:00-11:30 彈性時間", "11:30 離開，午餐", "13:00 出發往馬貝拉", "16:00-16:30 抵達馬貝拉並 check-in", "17:00-18:00 選手報到 + EXPO"],
                food_recommendation: "格拉納達提供免費 Tapas！餐後甜點推薦 Piononos (一種小糕點)。",
                accommodationName: "La Maestranza 8 b Lotta (4晚)",
                accommodationAddress: "Calle las ventas, Bajo, 29670 馬貝拉, 西班牙"
            },
            { 
                day: 4, 
                date: "11/7 (五)", 
                location: "馬貝拉", 
                title: "馬貝拉（賽事準備）", 
                transport: "市區內移動。", 
                activities: ["領取租賃自行車（雅菁）", "EXPO 參觀", "海域試游", "賽道勘查", "女生轉換區 Check-in", "高碳水晚餐", "早點休息"],
                food_recommendation: "賽前準備：以均衡的高碳水地中海飲食為主。",
                accommodationName: "La Maestranza 8 b Lotta (續住)",
                accommodationAddress: "Calle las ventas, Bajo, 29670 馬貝拉, 西班牙"
            },
            { 
                day: 5, 
                date: "11/8 (六)", 
                location: "馬貝拉", 
                title: "🔥 馬貝拉（女子組賽事）", 
                transport: "SUV 協助後勤。", 
                activities: ["8:00 雅菁開賽（女子組）", "親友團關鍵點位加油", "男生領取自行車（光武、皓中哥、志裕哥）", "男生轉換區 Check-in", "晚餐慶祝/早休息"],
                food_recommendation: "賽後慶祝：享受馬貝拉的高級海鮮餐廳或 Tapas bar。",
                accommodationName: "La Maestranza 8 b Lotta (續住)",
                accommodationAddress: "Calle las ventas, Bajo, 29670 馬貝拉, 西班牙"
            },
            { 
                day: 6, 
                date: "11/9 (日)", 
                location: "馬貝拉", 
                title: "🔥 馬貝拉（男子組賽事）", 
                transport: "SUV 協助後勤。", 
                activities: ["8:00 男子組開賽（光武、皓中哥、志裕哥）", "下午轉換區 Check-out", "慶祝晚宴"],
                food_recommendation: "賽後慶祝晚宴，全體為三位鐵人喝采！",
                accommodationName: "La Maestranza 8 b Lotta (最後一晚)",
                accommodationAddress: "Calle las ventas, Bajo, 29670 馬貝拉, 西班牙"
            },
            { 
                day: 7, 
                date: "11/10 (一)", 
                location: "馬貝拉 → 隆達 → 塞維亞", 
                title: "馬貝拉 → 隆達 → 塞維亞", 
                transport: "SUV 自駕 (馬貝拉-隆達-塞維亞: 3hr 5min，含隆達停留 2hr)。", 
                activities: ["8:00 早餐", "9:30 退房、還自行車", "10:30 出發", "12:00 抵達隆達", "隆達新橋 & 老城（約 2hr）", "14:00 離開隆達", "16:30 抵達塞維亞", "20:00 晚餐/佛朗明哥秀（可選）"],
                food_recommendation: "推薦在隆達找一間面向峽谷的景觀餐廳享用午餐，同時欣賞新橋的壯麗景色。",
                accommodationName: "聖克魯斯街區的迷人公寓 + 伊瓦拉伯爵三世優雅之家酒店 (2晚)",
                accommodationAddress: "Calle Conde de Ibarra Número 12 portal 1, 1º A, 老城區, 41004 塞維利亞, 西班牙"
            },
            { 
                day: 8, 
                date: "11/11 (二)", 
                location: "塞維亞", 
                title: "塞維亞（深度遊）", 
                transport: "市區內移動（步行為主）。", 
                activities: ["水道橋", "塞維亞王宮（Alcázar）", "大教堂 + 希拉達塔", "西班牙廣場", "聖十字區漫步", "晚上佛朗明哥表演"],
                food_recommendation: "塞維亞的經典菜餚是 Cola de Toro (燉牛尾)，以及搭配當地雪利酒的 Jamón Ibérico (伊比利火腿)。",
                accommodationName: "聖克魯斯街區的迷人公寓 + 伊瓦拉伯爵三世優雅之家酒店 (續住)",
                accommodationAddress: "Calle Conde de Ibarra Número 12 portal 1, 1º A, 老城區, 41004 塞維利亞, 西班牙"
            },
            { 
                day: 9, 
                date: "11/12 (三)", 
                location: "塞維亞 → 梅里達 → 卡塞雷斯", 
                title: "塞維亞 → 梅里達 → 卡塞雷斯", 
                transport: "SUV 自駕 (塞維亞-卡塞雷斯: 2hr，含梅里達停留)。", 
                activities: ["上午塞維亞購物/遺珠景點", "中午出發", "梅里達羅馬劇院與競技場", "下午抵達卡塞雷斯", "卡塞雷斯老城區散步", "晚餐"],
                food_recommendation: "卡塞雷斯以火腿和奶酪聞名。必試 Torta del Casar (濃郁綿羊奶酪) 和高品質的 Ibérico Pork 製品。",
                accommodationName: "恩爾茨奧克多宮殿酒店",
                accommodationAddress: "Plaza San Antonio, 10003 Cáceres, Spain"
            },
            { 
                day: 10, 
                date: "11/13 (四)", 
                location: "卡塞雷斯 → 馬德里", 
                title: "卡塞雷斯 → 特魯希略 → Oropesa → 馬德里", 
                transport: "SUV 自駕 (卡塞雷斯-馬德里: 3.5hr / 297km，含停留)。", 
                activities: ["7:00 晨跑 30min", "8:00 早餐", "9:00 出發", "09:45 抵達特魯希略", "12:15 抵達 Oropesa", "13:30 午餐", "15:00 出發往馬德里", "16:30-17:00 抵達馬德里、還車", "20:00 晚餐 + 散步"],
                food_recommendation: "馬德里晚餐推薦：找一家道地的西班牙小吃店享用各式 Tapas。",
                accommodationName: "馬德里 Airbnb 公寓 A + B (2晚)",
                accommodationAddress: "Calle del Arenal, 8, 28013 Madrid, Spain"
            },
            { 
                day: 11, 
                date: "11/14 (五)", 
                location: "馬德里", 
                title: "馬德里（市區觀光）", 
                transport: "市區內移動（地鐵/步行）。", 
                activities: ["普拉多博物館", "馬德里王宮", "馬約爾廣場", "太陽門廣場", "Gran Vía 購物", "告別晚餐"],
                food_recommendation: "推薦在聖米格爾市場 (Mercado de San Miguel) 享受豐富的 Tapas 體驗。",
                accommodationName: "馬德里 Airbnb 公寓 A + B (最後一晚)",
                accommodationAddress: "Calle del Arenal, 8, 28013 Madrid, Spain"
            },
            { 
                day: 12, 
                date: "11/15 (六)", 
                location: "馬德里 → 台灣", 
                title: "馬德里 → 台灣", 
                transport: "11:00 前往馬德里機場，14:25 國際航班起飛。", 
                activities: ["整理行李", "最後的西班牙早餐", "11:00 前往機場", "辦理報到與退稅", "14:25 國際航班", "返回台灣"],
                food_recommendation: "",
                accommodationName: "無 (本日退房/返程)",
                accommodationAddress: ""
            }
        ];

        document.addEventListener('DOMContentLoaded', () => {
            renderChecklist();
            renderTimeline();
            renderCostChart();
            document.getElementById('total-cost').textContent = new Intl.NumberFormat('zh-TW').format(TRIP_DATA.estimatedCost);
        });

        const checklistContainer = document.getElementById('checklist-container');

        function renderChecklist() {
            checklistContainer.innerHTML = CHECKLIST_STATE.map(item => `
                <div id="item-${item.id}" class="flex items-center p-3 rounded-lg cursor-pointer transition duration-150 ${item.completed ? 'bg-green-50' : 'bg-gray-100 hover:bg-gray-200'}" onclick="toggleChecklist(${item.id})">
                    <span class="text-xl mr-3 ${item.completed ? 'text-green-600' : 'text-gray-400'}">
                        ${item.completed ? '✔' : '☐'}
                    </span>
                    <p class="text-gray-700 font-medium ${item.completed ? 'line-through text-gray-500' : ''}">${item.text}</p>
                </div>
            `).join('');
        }

        function toggleChecklist(id) {
            const index = CHECKLIST_STATE.findIndex(item => item.id === id);
            if (index !== -1) {
                CHECKLIST_STATE[index].completed = !CHECKLIST_STATE[index].completed;
                renderChecklist();
            }
        }

        const timelineContainer = document.getElementById('timeline-container');

        function renderTimeline() {
            timelineContainer.innerHTML = ITINERARY_DATA.map(item => `
                <div class="timeline-item">
                    <div class="timeline-dot"></div>
                    <button class="flex items-center justify-between w-full p-4 bg-white rounded-lg shadow-md hover:bg-indigo-50 transition duration-150 focus:outline-none" onclick="toggleDay(${item.day})">
                        <div class="flex items-center gap-4 flex-1">
                            <span class="text-lg font-bold ${(item.day === 5 || item.day === 6) ? 'text-amber-600' : 'text-indigo-700'}">${(item.day === 5 || item.day === 6) ? '🔥 ' : ''}Day ${item.day}: ${item.title}</span>
                        </div>
                        <div class="flex items-center gap-3">
                            <span class="text-sm font-medium text-gray-500 whitespace-nowrap">${item.date}</span>
                            <span id="icon-${item.day}" class="text-xl text-indigo-500">▼</span>
                        </div>
                    </button>

                    <div id="details-${item.day}" class="p-4 mt-2 ml-5 bg-white rounded-lg border border-indigo-100 hidden">
                        <!-- Accommodation Details -->
                        ${item.accommodationName && item.accommodationName.indexOf('無') === -1 && item.accommodationName.indexOf('本日退房') === -1 ? `
                            <h4 class="text-md font-semibold text-gray-700 mb-2 mt-1">🏠 當晚住宿：<span class="text-green-600">${item.accommodationName}</span></h4>
                            ${item.accommodationAddress && item.accommodationAddress !== '' ? `
                                <p class="text-gray-600 mb-2 text-sm">
                                    📍 地址: ${item.accommodationAddress} 
                                    <a href="${getGoogleMapsLink(item.accommodationAddress)}" target="_blank" class="ml-2 text-indigo-500 hover:text-indigo-700 font-medium underline">Google Maps</a>
                                </p>
                            ` : ''}
                            <hr class="my-3 border-indigo-100">
                        ` : ''}
                        
                        <!-- Transport Details -->
                        <h4 class="text-md font-semibold text-gray-700 mb-2">🚌 交通：<span class="text-indigo-600 font-normal">${item.transport}</span></h4>
                        
                        <!-- Activities -->
                        <h4 class="text-md font-semibold text-gray-700 mb-3">📋 當日活動:</h4>
                        <ul class="list-disc list-inside text-gray-600 pl-4 space-y-1">
                            ${item.activities.map(act => `<li>${act}</li>`).join('')}
                        </ul>
                        
                        <!-- FOOD RECOMMENDATION SECTION -->
                        ${item.food_recommendation ? `
                            <h4 class="text-md font-semibold text-gray-700 mt-4 mb-1">🍽️ 美食推薦:</h4>
                            <p class="text-amber-700 bg-amber-50 p-2 rounded-lg text-sm">${item.food_recommendation}</p>
                        ` : ''}
                    </div>
                </div>
            `).join('');
        }

        function toggleDay(dayId) {
            const detailsElement = document.getElementById(`details-${dayId}`);
            const iconElement = document.getElementById(`icon-${dayId}`);

            if (detailsElement.classList.contains('hidden')) {
                document.querySelectorAll('[id^="details-"]').forEach(el => el.classList.add('hidden'));
                document.querySelectorAll('[id^="icon-"]').forEach(el => el.textContent = '▼');

                detailsElement.classList.remove('hidden');
                iconElement.textContent = '▲';
            } else {
                detailsElement.classList.add('hidden');
                iconElement.textContent = '▼';
            }
        }

        function renderCostChart() {
            const ctx = document.getElementById('costBreakdownChart').getContext('2d');
            const data = TRIP_DATA.costBreakdown;

            new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: data.map(d => d.label),
                    datasets: [{
                        data: data.map(d => d.amount),
                        backgroundColor: data.map(d => d.color),
                        hoverOffset: 10
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                padding: 15,
                                font: { size: 13, family: 'Inter' }
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const label = context.label || '';
                                    const value = context.parsed;
                                    const percentage = data[context.dataIndex].percentage.toFixed(2);
                                    return `${label}: NT$${new Intl.NumberFormat('zh-TW').format(value)} (${percentage}%)`;
                                }
                            }
                        }
                    }
                }
            });
        }
    </script>
</body>
</html>
